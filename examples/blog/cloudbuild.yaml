steps:
  # Branch name conditional
  - name: 'bash'
    script: |
      #!/usr/bin/env bash

      if [[ $PROJECT_ID == *uat ]]; then
        echo "UAT env file configured"
        mv $_ENV_FILE_UAT .env
        ls -lah
        cat .env
      elif [[ $PROJECT_ID == *prod ]]; then
        echo "PROD env file configured"
        mv $_ENV_FILE_PROD .env
      else
          echo "Env value not defined. Error"
      fi
    automapSubstitutions: true
        
  # Yarn install
  - name: 'node'
    entrypoint: 'yarn'
		dir: 'examples/blog'
    args: ['install']

  # Yarn run build
  - name: 'node'
    entrypoint: 'yarn'
		dir: 'examples/blog'
    args: ['run', 'build']

  # Copy the build into GCP bucket
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
	  dir: 'examples/blog'
    args: ["gsutil", "-m", "rsync", "-r", "-c", "-d", "./build/", ${BRANCH_NAME}]
		automapSubstitutions: true
